<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConTour</title>
    
    <!-- Favicon – підтримка SVG та PNG для різних браузерів -->
    <link rel="icon" type="image/svg+xml" href="images/icon-logo.svg">
    <link rel="icon" type="image/png" href="images/icon-logo.png">
    
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- D3 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Pickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
    
    <!-- Власні стилі -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="images/icon-logo.svg" alt="ConTour" style="width: 40px; height: 40px;">
        </div>
        <div class="title">ConTour</div>
    </header>
    
    <div class="main">
        <div id="map">
            <div id="errorToast" class="error-toast">
                <span id="errorMessage"></span>
            </div>
            <div id="elevationTooltip" class="elevation-tooltip">0 м</div>
            <div id="customScaleBar" class="custom-scale-bar"></div>
        </div>
        
        <div class="sidebar">
            <!-- Пошук -->
            <div>
                <div class="section-title">Пошук місця</div>
                <div class="search-container">
                    <label for="searchInput" class="input-label" style="display:none;">Пошук</label>
                    <input type="text" id="searchInput" class="input-field" placeholder="Наприклад, Київ">
                    <button id="searchBtn" class="btn">
                        <img src="images/icon-search.svg" alt="Знайти" style="width:20px; height:20px; margin-right:4px;"> Знайти
                    </button>
                </div>
                <div id="searchError" class="text-muted" style="margin-top:0.5rem; color:#FF6B6B;"></div>
            </div>
            
            <!-- Координати кутів -->
            <div>
                <div class="section-title">Вибір ділянки</div>
                <p class="text-muted" style="margin-bottom:1rem;">
                    Клікніть на карті двічі: перший маркер — один кут, другий — протилежний.
                </p>
                
                <div class="coordinates-row">
                    <div class="input-group">
                        <label for="lat1" class="input-label">Широта (кут 1)</label>
                        <input type="text" id="lat1" class="input-field" placeholder="50.4501" readonly>
                    </div>
                    <div class="input-group">
                        <label for="lon1" class="input-label">Довгота (кут 1)</label>
                        <input type="text" id="lon1" class="input-field" placeholder="30.5234" readonly>
                    </div>
                </div>
                
                <div class="coordinates-row">
                    <div class="input-group">
                        <label for="lat2" class="input-label">Широта (кут 2)</label>
                        <input type="text" id="lat2" class="input-field" placeholder="50.3500" readonly>
                    </div>
                    <div class="input-group">
                        <label for="lon2" class="input-label">Довгота (кут 2)</label>
                        <input type="text" id="lon2" class="input-field" placeholder="30.6000" readonly>
                    </div>
                </div>
                
                <div style="display: flex; gap: 0.5rem; margin: 1rem 0;">
                    <button id="clearMarkersBtn" class="btn">
                        <img src="images/icon-clear.svg" alt="Прибрати маркери" style="width:20px; height:20px; margin-right:4px;"> Прибрати маркери
                    </button>
                    <button id="useMapExtent" class="btn">
                        <img src="images/icon-fullscreen.svg" alt="Весь екран" style="width:20px; height:20px; margin-right:4px;"> Весь екран
                    </button>
                </div>
            </div>
            
            <!-- Роздільна здатність сітки -->
            <div class="section-spacer">
                <div class="section-title">Роздільна здатність</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Кількість точок (X та Y)</span>
                        <span id="resVal">30</span>
                    </div>
                    <input type="range" id="resolution" min="2" max="128" value="30" step="1" style="background: linear-gradient(to right, #333 0%, #333 49%, #709DB0 49%, #709DB0 100%);">
                </div>
                <p class="text-muted ultra-light">
                    ⚡ Більше точок = детальніший рельєф, але довше завантаження. <span style="color:#709DB0;">64–128 – екстремально</span>
                </p>
            </div>

            <!-- Товщина ліній -->
            <div class="section-spacer">
                <div class="section-title">Товщина ліній</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Товщина контурів</span>
                        <span id="lineWidthVal">1.5</span>
                    </div>
                    <input type="range" id="lineWidth" min="0.1" max="1.5" value="1.5" step="0.1">
                </div>
                <p class="text-muted ultra-light">
                    ⚡ Товщина ліній у пікселях.
                </p>
            </div>

            <!-- Згладжування (новий слайдер) -->
            <div class="section-spacer">
                <div class="section-title">Згладжування</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Сила згладжування</span>
                        <span id="smoothVal">0</span>
                    </div>
                    <input type="range" id="smoothness" min="0" max="3" value="0" step="0.1">
                </div>
                <p class="text-muted ultra-light">
                    ⚡ Вищі значення = плавніший рельєф, але більше обчислень.
                </p>
            </div>

            <!-- Кількість рівнів -->
            <div class="section-spacer">
                <div class="section-title">Деталізація рельєфу</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Кількість рівнів</span>
                        <span id="levelsVal">10</span>
                    </div>
                    <input type="range" id="levels" min="3" max="30" value="10" step="1">
                </div>
                <p class="text-muted ultra-light">
                    ⚡ Тільки для лінійної мапи.
                </p>
            </div>

            <!-- Роздільна здатність експорту -->
            <div class="section-spacer">
                <div class="section-title">Роздільна здатність експорту</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Розмір зображення</span>
                        <span id="exportResVal">2048x2048</span>
                    </div>
                    <input type="range" id="exportResolution" min="0" max="4" value="2" step="1">
                </div>
                <p class="text-muted ultra-light">
                    ⚡ Вищий розмір = більша деталізація.
                </p>
            </div>
            
            <!-- Кнопка побудови -->
            <button id="getData" class="btn btn-primary">
                <img src="images/icon-build2.svg" alt="Отримати дані" style="width:20px; height:20px; margin-right:4px;"> Отримати дані та побудувати
            </button>
            
            <!-- Статистика -->
            <div class="stats" id="statsPanel">
                <div class="stat-row"><span>Мін. висота:</span> <span id="statMin">—</span></div>
                <div class="stat-row"><span>Макс. висота:</span> <span id="statMax">—</span></div>
                <div class="stat-row"><span>Перепад:</span> <span id="statRange">—</span></div>
                <div class="stat-row"><span>Точок отримано:</span> <span id="statPoints">0</span></div>
                <div class="stat-row"><span>Ширина (м):</span> <span id="statWidth">—</span></div>
                <div class="stat-row"><span>Висота (м):</span> <span id="statHeight">—</span></div>
                <div class="stat-row"><span>Площа (га):</span> <span id="statArea">—</span></div>
            </div>

            <!-- Тип мапи -->
            <div class="display-mode-wrapper">
                <div class="display-mode-label">Тип мапи</div>
                <div class="display-mode-selector">
                    <div class="display-mode-selected" id="displayModeSelected">Linear map</div>
                    <div class="display-mode-options" id="displayModeOptions">
                        <div class="display-mode-option" data-value="contour">Linear map</div>
                        <div class="display-mode-option" data-value="displacement">Displacement</div>
                        <div class="display-mode-option" data-value="clear">Clear map</div>
                    </div>
                </div>
            </div>

            <!-- Gradient Ramp (завжди видимий) -->
            <div id="gradientRamp" class="gradient-ramp">
                <div class="gradient-ramp-title">Gradient Ramp</div>
                <div class="gradient-ramp-bar-container">
                    <div class="gradient-ramp-bar" id="gradientRampBar"></div>
                    <div class="gradient-ramp-handle left-handle" id="gradientRampLeftHandle" style="left: 0%; background-color: #000000;"></div>
                    <div class="gradient-ramp-handle right-handle" id="gradientRampRightHandle" style="left: 100%; background-color: #ffffff;"></div>
                </div>
                <!-- Приховані контейнери для Pickr -->
            </div>

            <!-- Кольорова легенда (динамічна) -->
            <div class="color-legend">
                <div class="gradient-bar" id="legendGradientBar"></div>
                <div class="gradient-labels">
                    <span id="colorMin">0 м</span>
                    <span id="colorMid">50%</span>
                    <span id="colorMax">0 м</span>
                </div>
            </div>
            
            <!-- SVG-контейнер -->
            <div class="canvas-container">
                <svg id="contourSVG" width="400" height="400" viewBox="0 0 400 400" style="background-color: #1B1B1B;"></svg>
                <!-- Кнопки експорту -->
                <div class="export-buttons">
                    <button id="downloadSVG" class="btn small export-btn" data-mode="contour">
                        <img src="images/icon-svg.svg" alt="SVG" style="width:16px; height:16px; margin-right:4px;"> SVG
                    </button>
                    <button id="downloadJPEG" class="btn small export-btn" data-mode="raster">
                        <img src="images/icon-jpeg.svg" alt="JPEG" style="width:16px; height:16px; margin-right:4px;"> JPEG
                    </button>
                    <button id="downloadPNG" class="btn small export-btn" data-mode="both">
                        <img src="images/icon-png.svg" alt="PNG" style="width:16px; height:16px; margin-right:4px;"> PNG
                    </button>
                    <button id="downloadPDF" class="btn small export-btn" data-mode="both">
                        <img src="images/icon-pdf.svg" alt="PDF" style="width:16px; height:16px; margin-right:4px;"> PDF
                    </button>
                </div>
            </div>
            
            <div class="footer-links">
                Дані висот: Open-Elevation (SRTM) · Карта: OpenStreetMap
            </div>
        </div>
    </div>

    <script src="js/script.js"></script>
</body>
</html>